spring:
  # 数据源（本地开发占位，按需修改）
  datasource:
    url:  ${DB_URL:jdbc:mysql://pc-j6c1oer259zv98w65.rwlb.rds.aliyuncs.com:3306/hotel_search_pax?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai}
    username: ${DB_USERNAME:xwd_pax_0389516}
    password: ${DB_PASSWORD:lJfGo#Kgj$6H29y!1q&0SpDf4G*oi}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 1200000
      connection-timeout: 20000
      pool-name: HeyTripHotelSearch-HikariCP
  jpa:
    hibernate:
      ddl-auto: validate
    open-in-view: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQLDialect



  # Redis  配置
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:hotel!!search!!engine1234}
      database: ${REDIS_DB:0}
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
          max-wait: 10000

  # Elasticsearch 配置
  elasticsearch:
    uris: ${ES_URIS:http://elasticsearch:19200}
    username: ${ES_USERNAME:elastic}
    password: ${ES_PASSWORD:DA6oHeV8sUbratbDDPnfSvLLGC1jk5FU}
    connection-timeout:  1000
    socket-timeout: 30000


# 日志配置
logging:
  level:
    root: INFO
    org.apache.camel: INFO
    com.heytrip.hotel.search.api: INFO
    com.heytrip.hotel.search.app: INFO
    com.heytrip.hotel.search.ingest: INFO
    com.heytrip.hotel.search.infra: INFO
    com.heytrip.hotel.search.common: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/heytrip-hotel-search.log

heytrip:
  # 酒店数据供应商接口配置
  supplier:
    base-url: http://39.108.194.81:9031
    app: Pax
    secret: Pax@20251027
  # 通知邮件配置
  mail:
    enabled: false
    host: smtp.tz.mail.wo.cn
    port: 465
    user: pax@heytripgo.com
    pass: 59n-Evyy-d}-7V@k
    from: pax@heytripgo.com
    to: pax@heytripgo.com
    ssl: true
  # Elasticsearch 搜索配置
  search:
    read-alias: hotels_read
    write-alias: hotels_write
    index: hotels_v1
    # 基础权重配置
    name-cn-boost: 8.0
    name-en-boost: 5.0
    address-boost: 3.5
    pinyin-boost: 4.0
    address-pinyin-boost: 3.0
    tokens-boost: 4.5
    keywords-boost: 6.0
    ner-places-boost: 4.0
    ner-brands-boost: 7.0
    address-tokens-boost: 4.5

    # 权重倍数配置
    exact-match-boost-multiplier: 1.5
    expanded-query-boost-multiplier: 0.6
    location-intent-boost-multiplier: 1.5
    brand-intent-boost-multiplier: 1.5

    # 关键词提取配置
    keyword-top-k: 5

    # 匹配策略配置
    minimum-should-match: "1"
    short-query-threshold: 2
    medium-query-threshold: 5
    min-match-for-brand-query: 2
    min-match-divisor: 3

    # 性能配置
    max-result-window: 10000
    default-page-size: 10
    max-page-size: 100
    search-timeout-ms: 5000

    # 缓存配置
    enable-query-cache: true
    query-cache-ttl: 300

    # 功能开关
    enable-spell-check: true
    enable-query-expansion: true
    enable-function-score: false

    # 相关性优化
    star-rating-weight: 1.0
    review-score-weight: 1.0
    popularity-weight: 0.5
  # 搜索日志配置
  search-log:
    enabled: true
    # Redis Stream 配置
    stream-key: search:logs:stream
    consumer-group: search-log-consumer-group
    consumer-name: search-log-consumer-1

    # 批量消费配置
    batch-size: 500           # 每次最多读取500条
    poll-interval-ms: 2000    # 每2秒轮询一次
    block-ms: 100             # 阻塞等待100ms（避免空轮询）

    # 告警配置
    zero-result-threshold: 0.15      # 零结果率阈值 15%
    min-queries-for-alert: 100       # 最小查询数（避免低流量误报）

    # Redis Stream 维护配置
    max-stream-length: 100000        # Stream 最大长度（超过后自动清理）
    message-ttl-hours: 72            # 消息保留时间（小时）



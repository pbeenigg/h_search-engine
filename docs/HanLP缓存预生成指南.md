# HanLP ç¼“å­˜é¢„ç”ŸæˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

HanLP åœ¨é¦–æ¬¡åŠ è½½æ–‡æœ¬å­—å…¸æ—¶ä¼šè‡ªåŠ¨ç¼–è¯‘æˆäºŒè¿›åˆ¶ç¼“å­˜æ–‡ä»¶ï¼ˆ`.bin`ï¼‰ï¼Œä»¥æé«˜åç»­åŠ è½½é€Ÿåº¦ã€‚æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•é¢„å…ˆç”Ÿæˆè¿™äº›ç¼“å­˜æ–‡ä»¶ã€‚

---

## ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦é¢„ç”Ÿæˆç¼“å­˜ï¼Ÿ

### é—®é¢˜
- âŒ é¦–æ¬¡å¯åŠ¨æ—¶åŠ è½½å­—å…¸è€—æ—¶é•¿ï¼ˆå¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åç§’ï¼‰
- âŒ åœ¨å®¹å™¨ç¯å¢ƒä¸­å¯èƒ½æ²¡æœ‰å†™å…¥æƒé™
- âŒ æ‰“åŒ…æˆ JAR åæ— æ³•åœ¨è¿è¡Œæ—¶ç”Ÿæˆç¼“å­˜
- âŒ å¹¶å‘è¯·æ±‚æ—¶å¯èƒ½å¯¼è‡´é‡å¤åŠ è½½

### è§£å†³æ–¹æ¡ˆ
- âœ… é¢„å…ˆç”Ÿæˆç¼“å­˜æ–‡ä»¶
- âœ… å°†ç¼“å­˜æ–‡ä»¶æ‰“åŒ…åˆ°åº”ç”¨ä¸­
- âœ… åº”ç”¨å¯åŠ¨æ—¶ç›´æ¥åŠ è½½ç¼“å­˜ï¼Œæ— éœ€ç¼–è¯‘

---

## ğŸš€ æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ç”Ÿæˆï¼ˆæ¨èï¼‰

### æ­¥éª¤1ï¼šè¿è¡Œç”Ÿæˆè„šæœ¬

```bash
cd /Users/pbeenig/Dev/HotelTrip/hotel-search-engine
./scripts/generate_hanlp_cache.sh
```

### è„šæœ¬åŠŸèƒ½
- è‡ªåŠ¨æ£€æµ‹ Maven å’Œ Java ç¯å¢ƒ
- ç¼–è¯‘å¹¶è¿è¡Œç¼“å­˜ç”Ÿæˆå™¨
- éªŒè¯æ‰€æœ‰ç¼“å­˜æ–‡ä»¶æ˜¯å¦ç”ŸæˆæˆåŠŸ
- æ˜¾ç¤ºç¼“å­˜æ–‡ä»¶å¤§å°å’Œä½ç½®

### é¢„æœŸè¾“å‡º

```
==========================================
HanLP ç¼“å­˜æ–‡ä»¶ç”Ÿæˆè„šæœ¬
==========================================

é¡¹ç›®æ ¹ç›®å½•: /Users/pbeenig/Dev/HotelTrip/hotel-search-engine
HanLP æ•°æ®ç›®å½•: backend/common/data

==========================================
æ–¹æ³•1: ä½¿ç”¨ Maven è¿è¡Œç¼“å­˜ç”Ÿæˆå™¨
==========================================

æ£€æµ‹åˆ° Mavenï¼Œå¼€å§‹ç¼–è¯‘å’Œè¿è¡Œ...

[1/2] ç¼–è¯‘é¡¹ç›®...
[2/2] è¿è¡Œç¼“å­˜ç”Ÿæˆå™¨...

========================================
HanLP ç¼“å­˜æ–‡ä»¶ç”Ÿæˆå·¥å…·
========================================

[1/6] åŠ è½½æ ¸å¿ƒè¯å…¸...
âœ“ æ ¸å¿ƒè¯å…¸åŠ è½½æˆåŠŸ

[2/6] åŠ è½½è‡ªå®šä¹‰è¯å…¸...
âœ“ è‡ªå®šä¹‰è¯å…¸åŠ è½½æˆåŠŸ

[3/6] åŠ è½½ç®€ç¹ä½“è½¬æ¢å­—å…¸...
  ç®€ä½“: ç®€ä½“ä¸­æ–‡æµ‹è¯•
  ç¹ä½“: ç°¡é«”ä¸­æ–‡æ¸¬è©¦
  è½¬å›: ç®€ä½“ä¸­æ–‡æµ‹è¯•
âœ“ ç®€ç¹ä½“è½¬æ¢å­—å…¸åŠ è½½æˆåŠŸ

[4/6] åŠ è½½æ‹¼éŸ³å­—å…¸...
  ä¸­å›½ -> [zhong, guo]
âœ“ æ‹¼éŸ³å­—å…¸åŠ è½½æˆåŠŸ

[5/6] åŠ è½½å…³é”®è¯æå–æ¨¡å‹...
  å…³é”®è¯: [HanLP, è‡ªç„¶è¯­è¨€å¤„ç†, å·¥å…·]
âœ“ å…³é”®è¯æå–æ¨¡å‹åŠ è½½æˆåŠŸ

[6/6] åŠ è½½å‘½åå®ä½“è¯†åˆ«æ¨¡å‹...
  åœ°å: åŒ—äº¬
  åœ°å: å¤©å®‰é—¨å¹¿åœº
âœ“ å‘½åå®ä½“è¯†åˆ«æ¨¡å‹åŠ è½½æˆåŠŸ

========================================
âœ“ æ‰€æœ‰ç¼“å­˜æ–‡ä»¶ç”Ÿæˆå®Œæˆï¼
========================================

==========================================
éªŒè¯ç¼“å­˜æ–‡ä»¶
==========================================

æ£€æŸ¥ç¼“å­˜æ–‡ä»¶...
  âœ“ backend/common/data/dictionary/CoreNatureDictionary.txt.bin (45M)
  âœ“ backend/common/data/dictionary/CoreNatureDictionary.ngram.txt.bin (12M)
  âœ“ backend/common/data/dictionary/tc/s2t.txt.bin (4.5M)
  âœ“ backend/common/data/dictionary/tc/t2s.txt.bin (1.2M)

==========================================
âœ“ æ‰€æœ‰ç¼“å­˜æ–‡ä»¶ç”ŸæˆæˆåŠŸï¼
==========================================
```

---

## ğŸ”§ æ–¹æ³•2ï¼šæ‰‹åŠ¨è¿è¡Œ Java ç¨‹åº

### æ­¥éª¤1ï¼šç¼–è¯‘é¡¹ç›®

```bash
cd backend/common
mvn compile
```

### æ­¥éª¤2ï¼šè¿è¡Œç¼“å­˜ç”Ÿæˆå™¨

```bash
mvn exec:java -Dexec.mainClass="HanLPCacheGenerator"
```

æˆ–è€…ç›´æ¥ä½¿ç”¨ Java å‘½ä»¤ï¼š

```bash
# æŸ¥æ‰¾ HanLP JAR è·¯å¾„
HANLP_JAR=$(find ~/.m2/repository/com/hankcs/hanlp -name "*.jar" | head -1)

# ç¼–è¯‘
javac -cp "$HANLP_JAR" scripts/HanLPCacheGenerator.java

# è¿è¡Œ
cd backend/common
java -cp "../../scripts:$HANLP_JAR" HanLPCacheGenerator
```

---

## âš™ï¸ æ–¹æ³•3ï¼šåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆï¼ˆå·²é›†æˆï¼‰

### è‡ªåŠ¨é¢„çƒ­é…ç½®

å·²åˆ›å»º `HanLPCacheWarmer` ç»„ä»¶ï¼Œåœ¨ Spring Boot åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨é¢„çƒ­ HanLP ç¼“å­˜ï¼š

```java
@Slf4j
@Component
public class HanLPCacheWarmer implements ApplicationRunner {
    @Override
    public void run(ApplicationArguments args) {
        // é¢„åŠ è½½æ‰€æœ‰ HanLP åŠŸèƒ½
        HanLP.segment("é¢„çƒ­æµ‹è¯•");
        HanLP.convertToTraditionalChinese("ç®€ä½“");
        HanLP.convertToPinyinList("æµ‹è¯•");
        HanLP.extractKeyword("æµ‹è¯•æ–‡æœ¬", 1);
    }
}
```

### å¯åŠ¨æ—¥å¿—

åº”ç”¨å¯åŠ¨æ—¶ä¼šçœ‹åˆ°ï¼š

```
========================================
å¼€å§‹é¢„çƒ­ HanLP ç¼“å­˜...
========================================
[1/4] é¢„åŠ è½½åˆ†è¯åŠŸèƒ½...
âœ“ åˆ†è¯åŠŸèƒ½é¢„åŠ è½½å®Œæˆ
[2/4] é¢„åŠ è½½ç®€ç¹ä½“è½¬æ¢...
âœ“ ç®€ç¹ä½“è½¬æ¢é¢„åŠ è½½å®Œæˆ
[3/4] é¢„åŠ è½½æ‹¼éŸ³è½¬æ¢...
âœ“ æ‹¼éŸ³è½¬æ¢é¢„åŠ è½½å®Œæˆ
[4/4] é¢„åŠ è½½å…³é”®è¯æå–...
âœ“ å…³é”®è¯æå–é¢„åŠ è½½å®Œæˆ
========================================
âœ“ HanLP ç¼“å­˜é¢„çƒ­å®Œæˆï¼è€—æ—¶: 1234ms
========================================
```

### ä¼˜ç‚¹
- âœ… æ— éœ€æ‰‹åŠ¨æ“ä½œ
- âœ… ç¡®ä¿åº”ç”¨å¯åŠ¨å HanLP ç«‹å³å¯ç”¨
- âœ… é¦–æ¬¡è¯·æ±‚æ— å»¶è¿Ÿ

### ç¼ºç‚¹
- âŒ å¢åŠ åº”ç”¨å¯åŠ¨æ—¶é—´ï¼ˆçº¦ 1-3 ç§’ï¼‰
- âŒ å¦‚æœå®¹å™¨æ²¡æœ‰å†™å…¥æƒé™ï¼Œä»ä¼šå¤±è´¥

---

## ğŸ“¦ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æ–¹æ¡ˆAï¼šé¢„ç”Ÿæˆå¹¶æ‰“åŒ…

```bash
# 1. å¼€å‘ç¯å¢ƒç”Ÿæˆç¼“å­˜
./scripts/generate_hanlp_cache.sh

# 2. éªŒè¯ç¼“å­˜æ–‡ä»¶
ls -lh backend/common/data/dictionary/**/*.bin

# 3. æ‰“åŒ…åº”ç”¨ï¼ˆç¼“å­˜æ–‡ä»¶ä¼šè‡ªåŠ¨åŒ…å«ï¼‰
mvn clean package -DskipTests

# 4. éƒ¨ç½² JAR æ–‡ä»¶
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨å¤–éƒ¨æ•°æ®ç›®å½•

```bash
# 1. åˆ›å»ºå¤–éƒ¨æ•°æ®ç›®å½•
sudo mkdir -p /opt/hanlp-data
sudo chown app:app /opt/hanlp-data

# 2. å¤åˆ¶æ•°æ®å’Œç¼“å­˜æ–‡ä»¶
cp -r backend/common/data/* /opt/hanlp-data/

# 3. ä¿®æ”¹ hanlp.properties
# root=/opt/hanlp-data/

# 4. å¯åŠ¨åº”ç”¨
java -jar app.jar -Dhanlp.root=/opt/hanlp-data/
```

### æ–¹æ¡ˆCï¼šDocker å®¹å™¨

```dockerfile
FROM openjdk:17-slim

# å¤åˆ¶åº”ç”¨
COPY target/app.jar /app/app.jar

# å¤åˆ¶ HanLP æ•°æ®ï¼ˆåŒ…å«ç¼“å­˜ï¼‰
COPY backend/common/data /app/hanlp-data

# è®¾ç½® HanLP æ•°æ®ç›®å½•
ENV HANLP_ROOT=/app/hanlp-data

# ç¡®ä¿æœ‰å†™å…¥æƒé™ï¼ˆå¦‚æœéœ€è¦è¿è¡Œæ—¶ç”Ÿæˆï¼‰
RUN chmod -R 777 /app/hanlp-data

# å¯åŠ¨åº”ç”¨
CMD ["java", "-jar", "/app/app.jar"]
```

---

## ğŸ“Š ç¼“å­˜æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | å¤§å° | ç”¨é€” | æ˜¯å¦å¿…éœ€ |
|------|------|------|----------|
| `CoreNatureDictionary.txt.bin` | ~45MB | æ ¸å¿ƒè¯å…¸ | âœ… å¿…éœ€ |
| `CoreNatureDictionary.ngram.txt.bin` | ~12MB | äºŒå…ƒè¯å…¸ | âœ… å¿…éœ€ |
| `s2t.txt.bin` | ~4.5MB | ç®€è½¬ç¹ | å¯é€‰ |
| `t2s.txt.bin` | ~1.2MB | ç¹è½¬ç®€ | å¯é€‰ |
| `CustomDictionary.txt.bin` | å˜åŒ– | è‡ªå®šä¹‰è¯å…¸ | å¯é€‰ |

**æ€»å¤§å°**: çº¦ 60-70MB

---

## ğŸ” éªŒè¯ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆ

### æ–¹æ³•1ï¼šæ£€æŸ¥æ–‡ä»¶

```bash
# æŸ¥çœ‹æ‰€æœ‰ .bin æ–‡ä»¶
find backend/common/data -name "*.bin" -ls

# æ£€æŸ¥æ–‡ä»¶å¤§å°
du -sh backend/common/data/dictionary/**/*.bin
```

### æ–¹æ³•2ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—

å¦‚æœç¼“å­˜å·²å­˜åœ¨ï¼ŒHanLP ä¼šç›´æ¥åŠ è½½ `.bin` æ–‡ä»¶ï¼Œå¯åŠ¨é€Ÿåº¦æ˜æ˜¾åŠ å¿«ï¼š

```
# æœ‰ç¼“å­˜
HanLP ç¼“å­˜é¢„çƒ­å®Œæˆï¼è€—æ—¶: 500ms

# æ— ç¼“å­˜ï¼ˆé¦–æ¬¡ç”Ÿæˆï¼‰
HanLP ç¼“å­˜é¢„çƒ­å®Œæˆï¼è€—æ—¶: 5000ms
```

### æ–¹æ³•3ï¼šæµ‹è¯•ç®€ç¹ä½“è½¬æ¢

```bash
# å¯åŠ¨åº”ç”¨åæµ‹è¯•
curl -X POST http://localhost:8080/api/test/traditional \
  -H "Content-Type: application/json" \
  -d '{"text": "ç®€ä½“ä¸­æ–‡"}'

# é¢„æœŸå“åº”
{"traditional": "ç°¡é«”ä¸­æ–‡"}
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ç¼“å­˜æ–‡ä»¶ç”Ÿæˆå¤±è´¥

**é”™è¯¯**:
```
java.io.FileNotFoundException: data/dictionary/tc/s2t.txt.bin (Permission denied)
```

**è§£å†³**:
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la backend/common/data/dictionary/tc/

# æ·»åŠ å†™å…¥æƒé™
chmod -R 755 backend/common/data/
```

---

### Q2: æ‰¾ä¸åˆ° hanlp.properties

**é”™è¯¯**:
```
java.io.FileNotFoundException: hanlp.properties
```

**è§£å†³**:
```bash
# ç¡®ä¿é…ç½®æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
ls backend/common/src/main/resources/hanlp.properties

# æˆ–è€…åœ¨å¯åŠ¨æ—¶æŒ‡å®š
java -jar app.jar -Dhanlp.properties.path=/path/to/hanlp.properties
```

---

### Q3: å®¹å™¨ä¸­æ— æ³•å†™å…¥ç¼“å­˜

**è§£å†³æ–¹æ¡ˆ1**: é¢„å…ˆç”Ÿæˆç¼“å­˜å¹¶æ‰“åŒ…

```bash
# å¼€å‘ç¯å¢ƒç”Ÿæˆ
./scripts/generate_hanlp_cache.sh

# æ‰“åŒ…æ—¶åŒ…å«ç¼“å­˜
mvn package
```

**è§£å†³æ–¹æ¡ˆ2**: ä½¿ç”¨ Volume æŒ‚è½½

```yaml
# docker-compose.yml
services:
  app:
    volumes:
      - ./hanlp-data:/app/hanlp-data
    environment:
      - HANLP_ROOT=/app/hanlp-data
```

---

### Q4: ç¼“å­˜æ–‡ä»¶è¿‡å¤§

**ä¼˜åŒ–å»ºè®®**:

1. **åªç”Ÿæˆéœ€è¦çš„ç¼“å­˜**
   ```java
   // ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½
   // ä¸è°ƒç”¨ HanLP.convertToTraditionalChinese() å°±ä¸ä¼šç”Ÿæˆç®€ç¹ä½“ç¼“å­˜
   ```

2. **ä½¿ç”¨å¤–éƒ¨å­˜å‚¨**
   ```bash
   # ä¸æ‰“åŒ…åˆ° JARï¼Œä½¿ç”¨å¤–éƒ¨ç›®å½•
   -Dhanlp.root=/opt/hanlp-data/
   ```

3. **å‹ç¼©ç¼“å­˜æ–‡ä»¶**
   ```bash
   # ç”Ÿäº§ç¯å¢ƒå¯ä»¥å‹ç¼©ä¼ è¾“
   tar -czf hanlp-cache.tar.gz backend/common/data/**/*.bin
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [HanLP å®˜æ–¹æ–‡æ¡£](https://github.com/hankcs/HanLP)
- [åŒä¹‰è¯ç®¡ç†ä¸ç»´æŠ¤æ–¹æ¡ˆ](./åŒä¹‰è¯ç®¡ç†ä¸ç»´æŠ¤æ–¹æ¡ˆ.md)
- [NLP å¢å¼ºåŠŸèƒ½å®æ–½è®°å½•](./ç¬¬äºŒå‘¨å¢å¼ºåŠŸèƒ½å®æ–½è®°å½•.md)

---

## âœ… æ€»ç»“

### æ¨èæµç¨‹

1. **å¼€å‘ç¯å¢ƒ**: è¿è¡Œ `./scripts/generate_hanlp_cache.sh` ç”Ÿæˆç¼“å­˜
2. **æµ‹è¯•éªŒè¯**: å¯åŠ¨åº”ç”¨ï¼ŒæŸ¥çœ‹é¢„çƒ­æ—¥å¿—
3. **æ‰“åŒ…éƒ¨ç½²**: ç¼“å­˜æ–‡ä»¶è‡ªåŠ¨åŒ…å«åœ¨ JAR ä¸­
4. **ç”Ÿäº§ç¯å¢ƒ**: åº”ç”¨å¯åŠ¨æ—¶ç›´æ¥åŠ è½½ç¼“å­˜ï¼Œæ— éœ€é‡æ–°ç”Ÿæˆ

### å…³é”®è¦ç‚¹

- âœ… ç¼“å­˜æ–‡ä»¶å¯ä»¥é¢„å…ˆç”Ÿæˆ
- âœ… ç”Ÿæˆåå¯ä»¥é‡å¤ä½¿ç”¨
- âœ… å»ºè®®åœ¨å¼€å‘ç¯å¢ƒç”Ÿæˆï¼Œæ‰“åŒ…åˆ°ç”Ÿäº§ç¯å¢ƒ
- âœ… ä½¿ç”¨ `HanLPCacheWarmer` ç¡®ä¿å¯åŠ¨æ—¶é¢„çƒ­
- âœ… å®šæœŸæ›´æ–°è¯å…¸åéœ€è¦é‡æ–°ç”Ÿæˆç¼“å­˜

## 酒店搜索效果优化方案

### 需求背景
当前酒店搜索功能在用户体验和搜索结果相关性方面存在一些不足，用户反馈搜索结果不够精准，界面交互不够友好。为了提升用户满意度和转化率，需要对酒店搜索功能进行优化。

### 搜索优化点列举
1. 引入多维度搜索算法，结合关键词匹配、地理位置、高德POI地标数据等因素进行综合排序。
2. 优化搜索结果的权重分配，提升热门酒店和高评分酒店的排名。
3. 多方未搜索结果进行融合，采用异步加载技术，提升搜索响应速度。
4. 搜索数据1：ES酒店索引  @[HotelIndexDoc.java](../backend/infra/src/main/java/com/heytrip/hotel/search/infra/search/doc/HotelIndexDoc.java)
5. 搜索数据2：ES地标索引(POI） @[AmapPoiIndexDoc.java](../backend/infra/src/main/java/com/heytrip/hotel/search/infra/search/doc/AmapPoiIndexDoc.java)
6. 搜索辅助1： IP地址定位工具  @[IpLocationUtil.java](../backend/common/src/main/java/com/heytrip/hotel/search/common/util/IpLocationUtil.java)
7. 搜索辅助2:  AI推荐引擎服务(暂不实现，暂时预留)  @[AiRecommendationService.java](../backend/infra/src/main/java/com/heytrip/hotel/search/infra/ai/AiRecommendationService.java)
6. 搜素辅助3：  ES（酒店+POI）+ 转向量数据（TextEmbedding模型）检索结合 (暂不实现，暂时预留) @[VectorSearchUtil.java](../backend/infra/src/main/java/com/heytrip/hotel/search/infra/search/util/VectorSearchUtil.java)
7. 用户可输入的参数： 搜索关键字，用户当前IP,用户指定地理区域（支持国家、城市），最终输出给用户的是从酒店索引中搜索到的酒店列表， 默认分页展示5条酒店数据。
8. 通过用户当前IP地址，如果获取到了用户地理位置，就优先展示用户所在城市的酒店， 如果IP获取的地理位置没有在酒店索引匹配到酒店，则再次通过高德POI地标索引，获取用户附近的地标信息，再通过地标信息匹配附近酒店进行展示。
9. 如果用户指定了地理区域，则优先在指定区域内进行酒店索引搜索,如果指定区域没有搜索到酒店，则通过高德POI地标索引，获取该区域内的地标信息，再通过地标信息匹配酒店索引里附近酒店进行展示。
10. 如果用户既没有指定地理区域，也没有获取到有效的IP地理位置，则直接通过酒店索引进行关键词搜索展示结果。
11. 搜索结果排序规则： 关键词匹配度（40） + 距离用户位置远近（20） + 酒店评分（20） + 历史搜索偏好（10） + 热门程度（10）等综合排序，需要标记权重分配。
12. 搜索结果展示字段： 酒店名称，酒店地址，酒店评分，酒店图片，酒店价格，距离用户位置距离等。
13. 搜索结果分页： 每页展示5条酒店数据，支持分页加载更多。
14. 搜索结果缓存： 对热门搜索关键词和地理位置进行缓存，提升搜索响应速度。
15. 搜索结果日志记录： 记录用户搜索关键词、地理位置、搜索时间等信息，用于后续分析和优化。 搜索日志服务（需要改造）： @[SearchLogService.java](../backend/infra/src/main/java/com/heytrip/hotel/search/infra/search/SearchLogService.java)
16. 搜索流程设计：
   - 接收用户搜索请求，获得IP地址，包含关键词和可选的地理位置等相关参数
   - 通过IP地址获取用户地理位置（如果正确获得到IP地址）（异步获取）
   - 优先在酒店索引中进行关键词搜索匹配，结合地理位置参数进行过滤和排序（异步获取）
   - 再从POI地标索引中搜索相关地标，再通过地标信息匹配酒店索引里的酒店列表（异步获取）
   - 过滤掉无效数据，异常格式数据
   - 在综合酒店索引和地标匹配的酒店列表聚合，然后根据预设的排序规则和权重进行排序以及择选
   - 最后格式化输出酒店搜索结果（支持分页展示）
   - 记录搜索日志信息（异步记录）
   - 返回搜索结果给用户
17. 性能优化： 使用异步处理和多线程技术，提升搜索响应速度，确保在高并发情况下依然能够快速响应用户请求。
18. API接口：[SearchController.java](../backend/api/src/main/java/com/heytrip/hotel/search/api/controller/SearchController.java)

